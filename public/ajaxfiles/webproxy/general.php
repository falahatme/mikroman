<div class="row">
	<div id="breadcrumb" class="col-xs-12">
		<a href="#" class="show-sidebar">
			<i class="fa fa-bars"></i>
		</a>
		<ol class="breadcrumb pull-left">
			<li><a href="index.html">Dashboard</a></li>
			<li><a href="#">Charts</a></li>
			<li><a href="#">Google Chart API</a></li>
		</ol>
		<div id="social" class="pull-right">
			<a href="#"><i class="fa fa-google-plus"></i></a>
			<a href="#"><i class="fa fa-facebook"></i></a>
			<a href="#"><i class="fa fa-twitter"></i></a>
			<a href="#"><i class="fa fa-linkedin"></i></a>
			<a href="#"><i class="fa fa-youtube"></i></a>
		</div>
	</div>
</div>

<div class="row">
	<div class="col-xs-12 col-sm-4">
		<div class="box">
			<div class="box-header">
				<div class="box-name">
					<i class="fa fa-bullseye"></i>
					<span>Top 10 Website Visit</span>
				</div>
				<div class="box-icons">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>
					<a class="expand-link">
						<i class="fa fa-expand"></i>
					</a>
					<a class="close-link">
						<i class="fa fa-times"></i>
					</a>
				</div>
				<div class="no-move"></div>
			</div>
			<div class="box-content" style="padding:0 2px 0 2px; text-align:center; overflow:hidden">
				<div id="google-chart-1" style="min-height: 260px; min-width:550px; margin-left:-100px;"></div>
			</div>
		</div>
	</div>

	<div class="col-xs-12 col-sm-4">
		<div class="box">
			<div class="box-header">
				<div class="box-name">
					<i class="fa fa-circle"></i>
					<span>Top 10 Active Users-IP's</span>
				</div>
				<div class="box-icons">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>
					<a class="expand-link">
						<i class="fa fa-expand"></i>
					</a>
					<a class="close-link">
						<i class="fa fa-times"></i>
					</a>
				</div>
				<div class="no-move"></div>
			</div>
			<div class="box-content" style="padding:0 2px 0 2px; text-align:center; overflow:hidden">
				<div id="google-chart-2" style="min-height: 260px; min-width:550px; margin-left:-100px;"></div>
			</div>
		</div>
	</div>

	<div class="col-xs-12 col-sm-4">
		<div class="box">
			<div class="box-header">
				<div class="box-name">
					<i class="fa fa-bullseye"></i>
					<span>Top 10 Server Visit </span>
				</div>
				<div class="box-icons">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>
					<a class="expand-link">
						<i class="fa fa-expand"></i>
					</a>
					<a class="close-link">
						<i class="fa fa-times"></i>
					</a>
				</div>
				<div class="no-move"></div>
			</div>
			<div class="box-content" style="padding:0 2px 0 2px; text-align:center; overflow:hidden">
				<div id="google-chart-3" style="min-height: 260px; min-width:550px; margin-left:-100px;"></div>
			</div>
		</div>
	</div>

</div>


<div class="row">
	<div class="col-xs-12 col-sm-6">
		<div class="box">
			<div class="box-header">
				<div class="box-name">
					<i class="fa fa-search"></i>
					<span>Top 5 Denied Websites</span>
				</div>
				<div class="box-icons">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>
					<a class="expand-link">
						<i class="fa fa-expand"></i>
					</a>
					<a class="close-link">
						<i class="fa fa-times"></i>
					</a>
				</div>
				<div class="no-move"></div>
			</div>
			<div class="box-content">
				<div id="xchart-4" style="height: 200px;"></div>
			</div>
		</div>
	</div>
    
	<div class="col-xs-12 col-sm-6">
		<div class="box">
			<div class="box-header">
				<div class="box-name">
					<i class="fa fa-search"></i>
					<span>Content Types</span>
				</div>
				<div class="box-icons">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>
					<a class="expand-link">
						<i class="fa fa-expand"></i>
					</a>
					<a class="close-link">
						<i class="fa fa-times"></i>
					</a>
				</div>
				<div class="no-move"></div>
			</div>
			<div class="box-content">
				<div id="am-chart-5" style="height: 200px;width: 400px;"></div>
			</div>
		</div>
	</div>


</div>
<div class="row">

	<div class="col-xs-12 col-sm-6">
		<div class="box">
			<div class="box-header">
				<div class="box-name">
					<i class="fa fa-search"></i>
					<span>Top 5 Largest Visited Files</span>
				</div>
				<div class="box-icons">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>
					<a class="expand-link">
						<i class="fa fa-expand"></i>
					</a>
					<a class="close-link">
						<i class="fa fa-times"></i>
					</a>
				</div>
				<div class="no-move"></div>
			</div>
			<div class="box-content">
				<div id="xchart-6" style="height: 200px;"></div>
			</div>
		</div>
	</div>



	<div class="col-xs-12  col-sm-6">
		<div class="box">
			<div class="box-header">
				<div class="box-name">
					<i class="fa fa-map-marker"></i>
					<span>Visited Countries</span>
				</div>
				<div class="box-icons">
					<a class="collapse-link">
						<i class="fa fa-chevron-up"></i>
					</a>
					<a class="expand-link">
						<i class="fa fa-expand"></i>
					</a>
					<a class="close-link">
						<i class="fa fa-times"></i>
					</a>
				</div>
				<div class="no-move"></div>
			</div>
			<div class="box-content">
				<div id="google-chart-7" style="min-height: 400px;"></div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">


//
// One function for create all graphs on Google Chart page
//
function DrawAllCharts(){




<?php

$query = "SELECT host,count(host) as hostcount,ip FROM `log` WHERE ip!='' AND host!='' GROUP BY host ORDER BY hostcount DESC LIMIT 0,10";
$chart1 = Database::$db->query($query);

?>

	//  Chart 1
	var chart1_data = [
	['Website', 'Visits'],
    <?php
    $array = array();
while($row = $chart1->fetch_object()){
    $array[] = "['".$row->host."', ".$row->hostcount."]";
    }    
    echo implode(",\r\n", $array);
    ?>
	];
	var chart1_options = {
		backgroundColor: '#fcfcfc',
		//title: 'My Daily Activities',
		pieHole: 0.4
	};
	var chart1_element = 'google-chart-1';
	var chart1_type = google.visualization.PieChart;
	drawGoogleChart(chart1_data, chart1_options, chart1_element, chart1_type);







<?php

$query = "SELECT count(ip) as ipcount,ip FROM `log` WHERE ip!='' GROUP BY ip ORDER BY ipcount DESC LIMIT 0,10";
$chart2 = Database::$db->query($query);

?>

	//  Chart 2
	var chart2_data = [
		['IP', 'Count'],
    <?php
    $array = array();
while($row = $chart2->fetch_object()){
    $array[] = "['".$row->ip."', ".$row->ipcount."]";
    }    
    echo implode(",\r\n", $array);
    ?>
	];
	var chart2_options = {
		//title: 'Smartphone marketshare 2Q 2013',
		backgroundColor: '#fcfcfc'
	};
	var chart2_element = 'google-chart-2';
	var chart2_type = google.visualization.PieChart;
	drawGoogleChart(chart2_data, chart2_options, chart2_element, chart2_type);





<?php

$query = "SELECT count(target_ip) as target_ipcount,target_ip FROM `firewall` WHERE target_ip!='' GROUP BY target_ip ORDER BY target_ipcount DESC LIMIT 0,10";
$chart3 = Database::$db->query($query);

?>
               //  Chart 3
	var chart3_data = [
	['IP', 'Count'],
    <?php
    $array = array();
while($row = $chart3->fetch_object()){
    $array[] = "['".$row->target_ip."', ".$row->target_ipcount."]";
    }    
    echo implode(",\r\n", $array);
    ?>
	];
	var chart3_options = {
		backgroundColor: '#fcfcfc',
		//title: 'My Daily Activities',
		pieHole: 0.4
	};
	var chart3_element = 'google-chart-3';
	var chart3_type = google.visualization.PieChart;
	drawGoogleChart(chart3_data, chart3_options, chart3_element, chart3_type);
        




<?php

$query = "
SELECT count( request ) AS requestcount, request
FROM `log`
WHERE (request != '' AND request NOT LIKE '%favicon%')
AND ACTION = 'deny'
GROUP BY request
ORDER BY requestcount DESC
LIMIT 0 , 5";
$chart4 = Database::$db->query($query);

?>

var data = {
	"xScale": "ordinal",
	"yScale": "linear",
	"main": [
		{
		"className": ".xchart-class-1",
		"data": [
    <?php
    $array = array();
while($row = $chart4->fetch_object()){
    $partedUrl = explode('/', str_replace(array('maxcdn.', 'fonts.', 'http://', 'www.', '.com'), '', $row->request));
    echo  '{"x":"'.$partedUrl[0].'", "y":'.$row->requestcount.'},'."\r\n";
    }    
    ?>
		]
		}
		]
	};
	var myChart = new xChart('bar', data, '#xchart-4');








    
<?php


    $cts = array(
    'application' => 0,
    'audio' => 0,
    'chemical' => 0,
    'image' => 0,
    'model' => 0,
    'text' => 0,
    'video' => 0
    );
    
$query = "
SELECT count( content_type ) AS ctcount, content_type
FROM `log`
GROUP BY content_type
ORDER BY ctcount DESC";
$chart5 = Database::$db->query($query);

while($row = $chart5->fetch_object()){
    
    $parts  = explode('/', $row->content_type);
    $ctype = trim($parts[0]);
    if(array_key_exists($ctype, $cts)){
        $cts[$ctype] += $row->ctcount;
        }
    
    }
arsort($cts);
?>
	var chart;
	var data = [
    <?php
    $array = array();
foreach($cts as $key=>$value){
    if($value>0){
        $partedUrl = explode('/', str_replace(array('maxcdn.', 'fonts.', 'http://', 'www.', '.com'), '', $row->request));
        echo  '{"title":"'.$key.'", "value":'.$value.'},'."\r\n";
        }    
    }
    ?>
	];
	chart = new AmCharts.AmFunnelChart();
	chart.rotate = true;
	chart.titleField = "title";
	chart.balloon.fixedPosition = true;
	chart.marginRight = 150;
	chart.marginLeft = 15;
	chart.labelPosition = "right";
	chart.funnelAlpha = 0.9;
	chart.valueField = "value";
	chart.startX = 0;
	chart.dataProvider = data;
	chart.startAlpha = 0.6;
	chart.depth3D = 100;
	chart.angle = 30;
	chart.outlineAlpha = 1;
	chart.outlineThickness = 2;
	chart.outlineColor = "#FFFFFF";
	chart.write("am-chart-5");








<?php

$query = "
SELECT content_length, content_type, request
FROM `log`
GROUP BY request
ORDER BY content_length DESC
LIMIT 0 , 5";
$chart6 = Database::$db->query($query);

?>
var data = {
	"xScale": "ordinal",
	"yScale": "linear",
	"main": [
		{
		"className": ".xchart-class-2",
		"data": [
    <?php
    $array = array();
    $i = 1;
while($row = $chart6->fetch_object()){
    $partedUrl = array_reverse(explode('/', str_replace(array('maxcdn.', 'fonts.', 'http://', 'www.', '.com'), '', $row->content_type)));
    echo  '{"x":"'.$i.' '.$partedUrl[0].'", "y":'.($row->content_length/1048576).'},'."\r\n";
    $i++;
    }    
    ?>
		]
		}
		]
	};
	var myChart = new xChart('bar', data, '#xchart-6');






	//  Chart 7
	var chart7_data = [
		['Country', 'Popularity'],
		['Germany', 200],
		['United States', 300],
		['Brazil', 400],
		['Canada', 500],
		['France', 600],
		['RUSSIA', 700]
	];
	var chart7_options = {
		backgroundColor: '#fcfcfc',
		enableRegionInteractivity: true
	};
	var chart7_element = 'google-chart-7';
	var chart7_type = google.visualization.GeoChart;
	drawGoogleChart(chart7_data, chart7_options, chart7_element, chart7_type);





    


setTimeout(DrawAllCharts, 5000);

}


$(document).ready(function() {
	// Load Google Chart API and callback to draw test graphs

// Google Charts
$.getScript('http://www.google.com/jsapi?autoload={%22modules%22%3A[{%22name%22%3A%22visualization%22%2C%22version%22%3A%221%22%2C%22packages%22%3A[%22corechart%22%2C%22geochart%22]%2C%22callback%22%3A%22DrawAllCharts%22}]}');
 
 // xCharts
  $.getScript('<?php echo SITE_URL?>plugins/d3/d3.min.js', LoadXChartScript);
  function LoadXChartScript(){
    $.getScript('<?php echo SITE_URL?>plugins/xcharts/xcharts.min.js');
  }

// AmCharts
function LoadAmchartsScripts(callback){
	function LoadAmchartsScript(){
		$.getScript('<?php echo SITE_URL?>plugins/amcharts/amcharts.js', LoadFunnelScript);
	}
	function LoadFunnelScript(){
		$.getScript('<?php echo SITE_URL?>plugins/amcharts/funnel.js', LoadSerialScript);
	}
	function LoadSerialScript(){
		$.getScript('<?php echo SITE_URL?>plugins/amcharts/serial.js', LoadPieScript);
	}
	function LoadPieScript(){
		$.getScript('<?php echo SITE_URL?>plugins/amcharts/pie.js', callback);
	}
	if (!$.fn.AmCharts){
		LoadAmchartsScript();
	}
	else {
		if (callback && typeof(callback) === "function") {
			callback();
		}
	}
}

LoadAmchartsScripts(DrawAllCharts);


	// This need for correct resize charts, when box open or drag
	var graphxChartsResize;
	$(".box").resize(function(event){
		event.preventDefault();
		clearTimeout(graphxChartsResize);
		graphxChartsResize = setTimeout(DrawAllCharts, 50);
    });
	// Add Drag-n-Drop action for .box
	WinMove();
    
});
</script>
<style>

#xchart-4 rect{
    fill:red !important;
}

</style>
